# 登录测试使用说明

## 问题说明

之前有两个后端服务同时运行：
- **端口8000**：工作正常 ✅
- **端口9000**：返回401错误 ❌（已停止）

如果您通过端口9000访问登录测试页面，所有4种测试方法都会失败。

---

## 正确的访问方式

### 方法1：直接访问登录测试页面（推荐）

在浏览器中打开：
```
http://localhost:8000/static/login_test.html
```

然后：
1. 确认页面底部的日志显示：`后端API地址: /api/auth/login`
2. 点击任意一个"测试登录"按钮
3. 查看测试结果

### 方法2：使用交易仪表板

在浏览器中打开：
```
http://localhost:8000/static/trading_dashboard.html
```

然后：
1. 使用默认账号：用户名 `admin`，密码 `admin123`
2. 点击"登录"按钮
3. 应该能够成功登录并进入主界面

### 方法3：使用curl命令测试

```bash
# 测试登录API
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"
```

预期返回：
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

---

## 测试账号信息

- **用户名**: `admin`
- **密码**: `admin123`
- **邮箱**: `admin@example.com`
- **角色**: `admin`

---

## 常见问题

### 1. 页面显示401错误

**原因**: 访问了错误的端口（如端口9000）

**解决**: 确保使用端口8000访问：
```
http://localhost:8000/static/login_test.html
```

### 2. 登录后提示"登录失败"

**检查清单**:
- [ ] 确认用户名和密码正确（admin / admin123）
- [ ] 确认使用的是端口8000
- [ ] 打开浏览器控制台（F12），查看错误信息

### 3. 测试页面无法加载

**检查清单**:
- [ ] 确认后端服务正在运行
- [ ] 确认使用正确的URL（端口8000）
- [ ] 检查网络连接

### 4. API调用失败

**检查清单**:
- [ ] 确认已经登录并获取了access_token
- [ ] 确认Authorization头部格式正确：`Bearer {token}`
- [ ] 打开浏览器控制台查看详细错误

---

## 调试方法

### 查看浏览器控制台

1. 在浏览器中按F12打开开发者工具
2. 切换到"Console"（控制台）标签
3. 查看是否有错误信息
4. 切换到"Network"（网络）标签
5. 点击"测试登录"按钮
6. 查看请求和响应的详细信息

### 查看后端日志

后端服务使用uvicorn运行，日志会直接输出到控制台。您可以看到：
- 请求的详细信息
- 响应状态码
- 错误信息

### 使用curl进行详细测试

```bash
# 详细模式查看请求和响应头
curl -v -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"

# 查看响应状态码
curl -w "\nHTTP Status: %{http_code}\n" \
  -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"
```

---

## 成功的登录流程

### 前端登录流程（trading_dashboard.html）

1. 用户输入用户名和密码
2. 前端发送POST请求到 `/api/auth/login`
3. 请求使用 `application/x-www-form-urlencoded` 格式
4. 后端验证用户名和密码
5. 后端返回access_token
6. 前端保存token并跳转到主界面
7. 后续API调用使用 `Authorization: Bearer {token}` 头部

### API调用示例

登录成功后，可以使用token访问其他API：

```bash
# 获取用户信息
TOKEN="your_access_token_here"
curl -X GET "http://localhost:8000/api/auth/me?token=$TOKEN"

# 获取机器人列表
curl -X GET "http://localhost:8000/api/bots/" \
  -H "Authorization: Bearer $TOKEN"

# 获取订单列表
curl -X GET "http://localhost:8000/api/orders/" \
  -H "Authorization: Bearer $TOKEN"
```

---

## 端口说明

- **端口8000**: 主要服务端口（开发模式，支持热重载）
- **端口9000**: 已停止（之前有全局认证问题）

**建议**: 始终使用端口8000进行开发和测试。

---

## 下一步

如果按照上述说明操作后仍有问题，请：

1. 打开浏览器控制台（F12）
2. 截图Network标签中的请求详情
3. 截图Console标签中的错误信息
4. 检查后端服务日志
5. 提供以上信息以便进一步排查

---

## 更新日志

### 2026-01-04
- 停止端口9000的服务（有认证问题）
- 确认端口8000服务正常工作
- 更新使用说明文档
