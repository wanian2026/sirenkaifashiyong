# 移除登录功能 - 使用说明

## 已完成的修改

### 前端修改
1. ✅ 移除了登录界面
2. ✅ 页面加载后直接显示主界面
3. ✅ 移除了所有API调用中的Authorization头部
4. ✅ 设置默认用户名为"Admin"

### 后端修改
1. ✅ 添加了可选认证函数 `get_optional_current_user`
2. ✅ 修改了主要API路由（bots、orders、trades、risk）使用可选认证
3. ✅ 当没有提供token时，自动使用admin用户

---

## 如何使用

### 步骤1：重启后端服务

**重要**：由于修改了后端代码，您需要重启uvicorn服务。

在您运行uvicorn的终端中：
1. 按 `Ctrl + C` 停止服务
2. 重新运行：
   ```bash
   python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

或者，如果想在后台运行：
```bash
nohup python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000 > uvicorn.log 2>&1 &
```

### 步骤2：访问交易系统

在浏览器中打开：
```
http://localhost:8000/static/trading_dashboard.html
```

**现在应该能够直接看到主界面，无需登录！**

### 步骤3：测试功能

尝试以下功能：
- 创建机器人
- 启动/停止机器人
- 查看机器人列表
- 查看订单

---

## 备份文件

原始的带登录功能的页面已备份为：
```
static/trading_dashboard_with_login_backup.html
```

如果需要恢复登录功能，可以：
```bash
cp static/trading_dashboard_with_login_backup.html static/trading_dashboard.html
```

---

## 技术说明

### 前端修改
- 移除了 `loginSection` HTML元素
- 移除了 `login()` 和 `logout()` 函数
- 移除了所有API调用中的 `Authorization` 头部
- 页面加载时自动初始化所有模块

### 后端修改
添加了 `get_optional_current_user` 函数（在 `app/auth.py` 中）：
- 不要求提供Authorization头部
- 直接返回admin用户
- 如果admin用户不存在，自动创建

修改的路由：
- `app/routers/bots.py`
- `app/routers/orders.py`
- `app/routers/trades.py`
- `app/routers/risk.py`

---

## 注意事项

### 开发模式
这个修改是为了简化开发流程，让用户无需登录即可使用系统。**不建议在生产环境中使用**。

### 安全考虑
在生产环境中，应该：
1. 恢复登录功能
2. 使用强密码
3. 启用HTTPS
4. 实现RBAC权限控制

### Admin用户
默认admin账号信息：
- 用户名：`admin`
- 密码：`admin123`
- 邮箱：`admin@example.com`
- 角色：`admin`

---

## 故障排查

### 问题1：API返回"未认证"错误

**原因**：后端服务没有重启，仍在使用旧代码

**解决**：重启uvicorn服务（Ctrl + C 停止，然后重新运行）

### 问题2：页面显示404

**原因**：可能访问了错误的URL

**解决**：确保访问 `http://localhost:8000/static/trading_dashboard.html`

### 问题3：创建机器人失败

**原因**：后端服务没有重启，或者API路由还有认证要求

**解决**：
1. 检查后端日志
2. 确认已重启服务
3. 检查数据库连接

---

## 更新日志

### 2026-01-04
- 移除前端登录界面
- 添加后端可选认证
- 修改主要API路由
- 创建使用说明文档
